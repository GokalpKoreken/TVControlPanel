{"ast":null,"code":"/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\n\nvar util = require('util'),\n  events = require('events'),\n  http = require('http'),\n  https = require('https'),\n  crypto = require('crypto'),\n  url = require('url'),\n  stream = require('stream'),\n  Options = require('options'),\n  Sender = require('./Sender'),\n  Receiver = require('./Receiver'),\n  SenderHixie = require('./Sender.hixie'),\n  ReceiverHixie = require('./Receiver.hixie');\n\n/**\n * Constants\n */\n\n// Default protocol version\n\nvar protocolVersion = 13;\n\n// Close timeout\n\nvar closeTimeout = 30000; // Allow 5 seconds to terminate the connection cleanly\n\n/**\n * WebSocket implementation\n */\n\nfunction WebSocket(address, protocols, options) {\n  if (protocols && !Array.isArray(protocols) && 'object' == typeof protocols) {\n    // accept the \"options\" Object as the 2nd argument\n    options = protocols;\n    protocols = null;\n  }\n  if ('string' == typeof protocols) {\n    protocols = [protocols];\n  }\n  if (!Array.isArray(protocols)) {\n    protocols = [];\n  }\n  // TODO: actually handle the `Sub-Protocols` part of the WebSocket client\n\n  this._socket = null;\n  this.bytesReceived = 0;\n  this.readyState = null;\n  this.supports = {};\n  if (Array.isArray(address)) {\n    initAsServerClient.apply(this, address.concat(options));\n  } else {\n    initAsClient.apply(this, [address, protocols, options]);\n  }\n}\n\n/**\n * Inherits from EventEmitter.\n */\n\nutil.inherits(WebSocket, events.EventEmitter);\n\n/**\n * Ready States\n */\n\n[\"CONNECTING\", \"OPEN\", \"CLOSING\", \"CLOSED\"].forEach(function (state, index) {\n  WebSocket.prototype[state] = WebSocket[state] = index;\n});\n\n/**\n * Gracefully closes the connection, after sending a description message to the server\n *\n * @param {Object} data to be sent to the server\n * @api public\n */\n\nWebSocket.prototype.close = function (code, data) {\n  if (this.readyState == WebSocket.CLOSING || this.readyState == WebSocket.CLOSED) return;\n  if (this.readyState == WebSocket.CONNECTING) {\n    this.readyState = WebSocket.CLOSED;\n    return;\n  }\n  try {\n    this.readyState = WebSocket.CLOSING;\n    this._closeCode = code;\n    this._closeMessage = data;\n    var mask = !this._isServer;\n    this._sender.close(code, data, mask);\n  } catch (e) {\n    this.emit('error', e);\n  } finally {\n    this.terminate();\n  }\n};\n\n/**\n * Pause the client stream\n *\n * @api public\n */\n\nWebSocket.prototype.pause = function () {\n  if (this.readyState != WebSocket.OPEN) throw new Error('not opened');\n  return this._socket.pause();\n};\n\n/**\n * Sends a ping\n *\n * @param {Object} data to be sent to the server\n * @param {Object} Members - mask: boolean, binary: boolean\n * @param {boolean} dontFailWhenClosed indicates whether or not to throw if the connection isnt open\n * @api public\n */\n\nWebSocket.prototype.ping = function (data, options, dontFailWhenClosed) {\n  if (this.readyState != WebSocket.OPEN) {\n    if (dontFailWhenClosed === true) return;\n    throw new Error('not opened');\n  }\n  options = options || {};\n  if (typeof options.mask == 'undefined') options.mask = !this._isServer;\n  this._sender.ping(data, options);\n};\n\n/**\n * Sends a pong\n *\n * @param {Object} data to be sent to the server\n * @param {Object} Members - mask: boolean, binary: boolean\n * @param {boolean} dontFailWhenClosed indicates whether or not to throw if the connection isnt open\n * @api public\n */\n\nWebSocket.prototype.pong = function (data, options, dontFailWhenClosed) {\n  if (this.readyState != WebSocket.OPEN) {\n    if (dontFailWhenClosed === true) return;\n    throw new Error('not opened');\n  }\n  options = options || {};\n  if (typeof options.mask == 'undefined') options.mask = !this._isServer;\n  this._sender.pong(data, options);\n};\n\n/**\n * Resume the client stream\n *\n * @api public\n */\n\nWebSocket.prototype.resume = function () {\n  if (this.readyState != WebSocket.OPEN) throw new Error('not opened');\n  return this._socket.resume();\n};\n\n/**\n * Sends a piece of data\n *\n * @param {Object} data to be sent to the server\n * @param {Object} Members - mask: boolean, binary: boolean\n * @param {function} Optional callback which is executed after the send completes\n * @api public\n */\n\nWebSocket.prototype.send = function (data, options, cb) {\n  if (typeof options == 'function') {\n    cb = options;\n    options = {};\n  }\n  if (this.readyState != WebSocket.OPEN) {\n    if (typeof cb == 'function') cb(new Error('not opened'));else throw new Error('not opened');\n    return;\n  }\n  if (!data) data = '';\n  if (this._queue) {\n    var self = this;\n    this._queue.push(function () {\n      self.send(data, options, cb);\n    });\n    return;\n  }\n  options = options || {};\n  options.fin = true;\n  if (typeof options.binary == 'undefined') {\n    options.binary = data instanceof ArrayBuffer || data instanceof Buffer || data instanceof Uint8Array || data instanceof Uint16Array || data instanceof Uint32Array || data instanceof Int8Array || data instanceof Int16Array || data instanceof Int32Array || data instanceof Float32Array || data instanceof Float64Array;\n  }\n  if (typeof options.mask == 'undefined') options.mask = !this._isServer;\n  var readable = typeof stream.Readable == 'function' ? stream.Readable : stream.Stream;\n  if (data instanceof readable) {\n    startQueue(this);\n    var self = this;\n    sendStream(this, data, options, function (error) {\n      process.nextTick(function () {\n        executeQueueSends(self);\n      });\n      if (typeof cb == 'function') cb(error);\n    });\n  } else this._sender.send(data, options, cb);\n};\n\n/**\n * Streams data through calls to a user supplied function\n *\n * @param {Object} Members - mask: boolean, binary: boolean\n * @param {function} 'function (error, send)' which is executed on successive ticks of which send is 'function (data, final)'.\n * @api public\n */\n\nWebSocket.prototype.stream = function (options, cb) {\n  if (typeof options == 'function') {\n    cb = options;\n    options = {};\n  }\n  var self = this;\n  if (typeof cb != 'function') throw new Error('callback must be provided');\n  if (this.readyState != WebSocket.OPEN) {\n    if (typeof cb == 'function') cb(new Error('not opened'));else throw new Error('not opened');\n    return;\n  }\n  if (this._queue) {\n    this._queue.push(function () {\n      self.stream(options, cb);\n    });\n    return;\n  }\n  options = options || {};\n  if (typeof options.mask == 'undefined') options.mask = !this._isServer;\n  startQueue(this);\n  var send = function (data, final) {\n    try {\n      if (self.readyState != WebSocket.OPEN) throw new Error('not opened');\n      options.fin = final === true;\n      self._sender.send(data, options);\n      if (!final) process.nextTick(cb.bind(null, null, send));else executeQueueSends(self);\n    } catch (e) {\n      if (typeof cb == 'function') cb(e);else {\n        delete self._queue;\n        self.emit('error', e);\n      }\n    }\n  };\n  process.nextTick(cb.bind(null, null, send));\n};\n\n/**\n * Immediately shuts down the connection\n *\n * @api public\n */\n\nWebSocket.prototype.terminate = function () {\n  if (this.readyState == WebSocket.CLOSED) return;\n  if (this._socket) {\n    try {\n      // End the connection\n      this._socket.end();\n    } catch (e) {\n      // Socket error during end() call, so just destroy it right now\n      cleanupWebsocketResources.call(this, true);\n      return;\n    }\n\n    // Add a timeout to ensure that the connection is completely\n    // cleaned up within 30 seconds, even if the clean close procedure\n    // fails for whatever reason\n    this._closeTimer = setTimeout(cleanupWebsocketResources.bind(this, true), closeTimeout);\n  } else if (this.readyState == WebSocket.CONNECTING) {\n    cleanupWebsocketResources.call(this, true);\n  }\n};\n\n/**\n * Expose bufferedAmount\n *\n * @api public\n */\n\nObject.defineProperty(WebSocket.prototype, 'bufferedAmount', {\n  get: function get() {\n    var amount = 0;\n    if (this._socket) {\n      amount = this._socket.bufferSize || 0;\n    }\n    return amount;\n  }\n});\n\n/**\n * Emulates the W3C Browser based WebSocket interface using function members.\n *\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\n\n['open', 'error', 'close', 'message'].forEach(function (method) {\n  Object.defineProperty(WebSocket.prototype, 'on' + method, {\n    /**\n     * Returns the current listener\n     *\n     * @returns {Mixed} the set function or undefined\n     * @api public\n     */\n\n    get: function get() {\n      var listener = this.listeners(method)[0];\n      return listener ? listener._listener ? listener._listener : listener : undefined;\n    },\n    /**\n     * Start listening for events\n     *\n     * @param {Function} listener the listener\n     * @returns {Mixed} the set function or undefined\n     * @api public\n     */\n\n    set: function set(listener) {\n      this.removeAllListeners(method);\n      this.addEventListener(method, listener);\n    }\n  });\n});\n\n/**\n * Emulates the W3C Browser based WebSocket interface using addEventListener.\n *\n * @see https://developer.mozilla.org/en/DOM/element.addEventListener\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\nWebSocket.prototype.addEventListener = function (method, listener) {\n  var target = this;\n  if (typeof listener === 'function') {\n    if (method === 'message') {\n      function onMessage(data, flags) {\n        listener.call(this, new MessageEvent(data, flags.binary ? 'Binary' : 'Text', target));\n      }\n      // store a reference so we can return the original function from the addEventListener hook\n      onMessage._listener = listener;\n      this.on(method, onMessage);\n    } else if (method === 'close') {\n      function onClose(code, message) {\n        listener.call(this, new CloseEvent(code, message, target));\n      }\n      // store a reference so we can return the original function from the addEventListener hook\n      onClose._listener = listener;\n      this.on(method, onClose);\n    } else if (method === 'error') {\n      function onError(event) {\n        event.target = target;\n        listener.call(this, event);\n      }\n      // store a reference so we can return the original function from the addEventListener hook\n      onError._listener = listener;\n      this.on(method, onError);\n    } else if (method === 'open') {\n      function onOpen() {\n        listener.call(this, new OpenEvent(target));\n      }\n      // store a reference so we can return the original function from the addEventListener hook\n      onOpen._listener = listener;\n      this.on(method, onOpen);\n    } else {\n      this.on(method, listener);\n    }\n  }\n};\nmodule.exports = WebSocket;\n\n/**\n * W3C MessageEvent\n *\n * @see http://www.w3.org/TR/html5/comms.html\n * @api private\n */\n\nfunction MessageEvent(dataArg, typeArg, target) {\n  this.data = dataArg;\n  this.type = typeArg;\n  this.target = target;\n}\n\n/**\n * W3C CloseEvent\n *\n * @see http://www.w3.org/TR/html5/comms.html\n * @api private\n */\n\nfunction CloseEvent(code, reason, target) {\n  this.wasClean = typeof code == 'undefined' || code == 1000;\n  this.code = code;\n  this.reason = reason;\n  this.target = target;\n}\n\n/**\n * W3C OpenEvent\n *\n * @see http://www.w3.org/TR/html5/comms.html\n * @api private\n */\n\nfunction OpenEvent(target) {\n  this.target = target;\n}\n\n/**\n * Entirely private apis,\n * which may or may not be bound to a sepcific WebSocket instance.\n */\n\nfunction initAsServerClient(req, socket, upgradeHead, options) {\n  options = new Options({\n    protocolVersion: protocolVersion,\n    protocol: null\n  }).merge(options);\n\n  // expose state properties\n  this.protocol = options.value.protocol;\n  this.protocolVersion = options.value.protocolVersion;\n  this.supports.binary = this.protocolVersion != 'hixie-76';\n  this.upgradeReq = req;\n  this.readyState = WebSocket.CONNECTING;\n  this._isServer = true;\n\n  // establish connection\n  if (options.value.protocolVersion == 'hixie-76') establishConnection.call(this, ReceiverHixie, SenderHixie, socket, upgradeHead);else establishConnection.call(this, Receiver, Sender, socket, upgradeHead);\n}\nfunction initAsClient(address, protocols, options) {\n  options = new Options({\n    origin: null,\n    protocolVersion: protocolVersion,\n    host: null,\n    headers: null,\n    protocol: null,\n    agent: null,\n    // ssl-related options\n    pfx: null,\n    key: null,\n    passphrase: null,\n    cert: null,\n    ca: null,\n    ciphers: null,\n    rejectUnauthorized: null\n  }).merge(options);\n  if (options.value.protocolVersion != 8 && options.value.protocolVersion != 13) {\n    throw new Error('unsupported protocol version');\n  }\n\n  // verify url and establish http class\n  var serverUrl = url.parse(address);\n  var isUnixSocket = serverUrl.protocol === 'ws+unix:';\n  if (!serverUrl.host && !isUnixSocket) throw new Error('invalid url');\n  var isSecure = serverUrl.protocol === 'wss:' || serverUrl.protocol === 'https:';\n  var httpObj = isSecure ? https : http;\n  var port = serverUrl.port || (isSecure ? 443 : 80);\n  var auth = serverUrl.auth;\n\n  // expose state properties\n  this._isServer = false;\n  this.url = address;\n  this.protocolVersion = options.value.protocolVersion;\n  this.supports.binary = this.protocolVersion != 'hixie-76';\n\n  // begin handshake\n  var key = new Buffer(options.value.protocolVersion + '-' + Date.now()).toString('base64');\n  var shasum = crypto.createHash('sha1');\n  shasum.update(key + '258EAFA5-E914-47DA-95CA-C5AB0DC85B11');\n  var expectedServerKey = shasum.digest('base64');\n  var agent = options.value.agent;\n  var headerHost = serverUrl.hostname;\n  // Append port number to Host and Origin header, only if specified in the url and non-default\n  if (serverUrl.port) {\n    if (isSecure && port != 443 || !isSecure && port != 80) {\n      headerHost = headerHost + ':' + port;\n    }\n  }\n  var requestOptions = {\n    port: port,\n    host: serverUrl.hostname,\n    headers: {\n      'Connection': 'Upgrade',\n      'Upgrade': 'websocket',\n      'Host': headerHost,\n      'Origin': headerHost,\n      'Sec-WebSocket-Version': options.value.protocolVersion,\n      'Sec-WebSocket-Key': key\n    }\n  };\n\n  // If we have basic auth.\n  if (auth) {\n    requestOptions.headers['Authorization'] = 'Basic ' + new Buffer(auth).toString('base64');\n  }\n  if (options.value.protocol) {\n    requestOptions.headers['Sec-WebSocket-Protocol'] = options.value.protocol;\n  }\n  if (options.value.host) {\n    requestOptions.headers['Host'] = options.value.host;\n  }\n  if (options.value.headers) {\n    for (var header in options.value.headers) {\n      if (options.value.headers.hasOwnProperty(header)) {\n        requestOptions.headers[header] = options.value.headers[header];\n      }\n    }\n  }\n  if (options.isDefinedAndNonNull('pfx') || options.isDefinedAndNonNull('key') || options.isDefinedAndNonNull('passphrase') || options.isDefinedAndNonNull('cert') || options.isDefinedAndNonNull('ca') || options.isDefinedAndNonNull('ciphers') || options.isDefinedAndNonNull('rejectUnauthorized')) {\n    if (options.isDefinedAndNonNull('pfx')) requestOptions.pfx = options.value.pfx;\n    if (options.isDefinedAndNonNull('key')) requestOptions.key = options.value.key;\n    if (options.isDefinedAndNonNull('passphrase')) requestOptions.passphrase = options.value.passphrase;\n    if (options.isDefinedAndNonNull('cert')) requestOptions.cert = options.value.cert;\n    if (options.isDefinedAndNonNull('ca')) requestOptions.ca = options.value.ca;\n    if (options.isDefinedAndNonNull('ciphers')) requestOptions.ciphers = options.value.ciphers;\n    if (options.isDefinedAndNonNull('rejectUnauthorized')) requestOptions.rejectUnauthorized = options.value.rejectUnauthorized;\n    if (!agent) {\n      // global agent ignores client side certificates\n      agent = new httpObj.Agent(requestOptions);\n    }\n  }\n  requestOptions.path = serverUrl.path || '/';\n  if (agent) {\n    requestOptions.agent = agent;\n  }\n  if (isUnixSocket) {\n    requestOptions.socketPath = serverUrl.pathname;\n  }\n  if (options.value.origin) {\n    if (options.value.protocolVersion < 13) requestOptions.headers['Sec-WebSocket-Origin'] = options.value.origin;else requestOptions.headers['Origin'] = options.value.origin;\n  }\n  var self = this;\n  var req = httpObj.request(requestOptions);\n  req.on('error', function (error) {\n    self.emit('error', error);\n    cleanupWebsocketResources.call(this, error);\n  });\n  req.once('response', function (res) {\n    if (!self.emit('unexpected-response', req, res)) {\n      var error = new Error('unexpected server response (' + res.statusCode + ')');\n      req.abort();\n      self.emit('error', error);\n    }\n    cleanupWebsocketResources.call(this, error);\n  });\n  req.once('upgrade', function (res, socket, upgradeHead) {\n    if (self.readyState == WebSocket.CLOSED) {\n      // client closed before server accepted connection\n      self.emit('close');\n      self.removeAllListeners();\n      socket.end();\n      return;\n    }\n    var serverKey = res.headers['sec-websocket-accept'];\n    if (typeof serverKey == 'undefined' || serverKey !== expectedServerKey) {\n      self.emit('error', 'invalid server key');\n      self.removeAllListeners();\n      socket.end();\n      return;\n    }\n    var serverProt = res.headers['sec-websocket-protocol'];\n    var protList = (options.value.protocol || \"\").split(/, */);\n    var protError = null;\n    if (!options.value.protocol && serverProt) {\n      protError = 'server sent a subprotocol even though none requested';\n    } else if (options.value.protocol && !serverProt) {\n      protError = 'server sent no subprotocol even though requested';\n    } else if (serverProt && protList.indexOf(serverProt) === -1) {\n      protError = 'server responded with an invalid protocol';\n    }\n    if (protError) {\n      self.emit('error', protError);\n      self.removeAllListeners();\n      socket.end();\n      return;\n    } else if (serverProt) {\n      self.protocol = serverProt;\n    }\n    establishConnection.call(self, Receiver, Sender, socket, upgradeHead);\n\n    // perform cleanup on http resources\n    req.removeAllListeners();\n    req = null;\n    agent = null;\n  });\n  req.end();\n  this.readyState = WebSocket.CONNECTING;\n}\nfunction establishConnection(ReceiverClass, SenderClass, socket, upgradeHead) {\n  this._socket = socket;\n  socket.setTimeout(0);\n  socket.setNoDelay(true);\n  var self = this;\n  this._receiver = new ReceiverClass();\n\n  // socket cleanup handlers\n  socket.on('end', cleanupWebsocketResources.bind(this));\n  socket.on('close', cleanupWebsocketResources.bind(this));\n  socket.on('error', cleanupWebsocketResources.bind(this));\n\n  // ensure that the upgradeHead is added to the receiver\n  function firstHandler(data) {\n    if (self.readyState != WebSocket.OPEN) return;\n    if (upgradeHead && upgradeHead.length > 0) {\n      self.bytesReceived += upgradeHead.length;\n      var head = upgradeHead;\n      upgradeHead = null;\n      self._receiver.add(head);\n    }\n    dataHandler = realHandler;\n    if (data) {\n      self.bytesReceived += data.length;\n      self._receiver.add(data);\n    }\n  }\n  // subsequent packets are pushed straight to the receiver\n  function realHandler(data) {\n    if (data) self.bytesReceived += data.length;\n    self._receiver.add(data);\n  }\n  var dataHandler = firstHandler;\n  // if data was passed along with the http upgrade,\n  // this will schedule a push of that on to the receiver.\n  // this has to be done on next tick, since the caller\n  // hasn't had a chance to set event handlers on this client\n  // object yet.\n  process.nextTick(firstHandler);\n\n  // receiver event handlers\n  self._receiver.ontext = function (data, flags) {\n    flags = flags || {};\n    self.emit('message', data, flags);\n  };\n  self._receiver.onbinary = function (data, flags) {\n    flags = flags || {};\n    flags.binary = true;\n    self.emit('message', data, flags);\n  };\n  self._receiver.onping = function (data, flags) {\n    flags = flags || {};\n    self.pong(data, {\n      mask: !self._isServer,\n      binary: flags.binary === true\n    }, true);\n    self.emit('ping', data, flags);\n  };\n  self._receiver.onpong = function (data, flags) {\n    self.emit('pong', data, flags);\n  };\n  self._receiver.onclose = function (code, data, flags) {\n    flags = flags || {};\n    self.close(code, data);\n  };\n  self._receiver.onerror = function (reason, errorCode) {\n    // close the connection when the receiver reports a HyBi error code\n    self.close(typeof errorCode != 'undefined' ? errorCode : 1002, '');\n    self.emit('error', reason, errorCode);\n  };\n\n  // finalize the client\n  this._sender = new SenderClass(socket);\n  this._sender.on('error', function (error) {\n    self.close(1002, '');\n    self.emit('error', error);\n  });\n  this.readyState = WebSocket.OPEN;\n  this.emit('open');\n  socket.on('data', dataHandler);\n}\nfunction startQueue(instance) {\n  instance._queue = instance._queue || [];\n}\nfunction executeQueueSends(instance) {\n  var queue = instance._queue;\n  if (typeof queue == 'undefined') return;\n  delete instance._queue;\n  for (var i = 0, l = queue.length; i < l; ++i) {\n    queue[i]();\n  }\n}\nfunction sendStream(instance, stream, options, cb) {\n  stream.on('data', function (data) {\n    if (instance.readyState != WebSocket.OPEN) {\n      if (typeof cb == 'function') cb(new Error('not opened'));else {\n        delete instance._queue;\n        instance.emit('error', new Error('not opened'));\n      }\n      return;\n    }\n    options.fin = false;\n    instance._sender.send(data, options);\n  });\n  stream.on('end', function () {\n    if (instance.readyState != WebSocket.OPEN) {\n      if (typeof cb == 'function') cb(new Error('not opened'));else {\n        delete instance._queue;\n        instance.emit('error', new Error('not opened'));\n      }\n      return;\n    }\n    options.fin = true;\n    instance._sender.send(null, options);\n    if (typeof cb == 'function') cb(null);\n  });\n}\nfunction cleanupWebsocketResources(error) {\n  if (this.readyState == WebSocket.CLOSED) return;\n  var emitClose = this.readyState != WebSocket.CONNECTING;\n  this.readyState = WebSocket.CLOSED;\n  clearTimeout(this._closeTimer);\n  this._closeTimer = null;\n  if (emitClose) this.emit('close', this._closeCode || 1000, this._closeMessage || '');\n  if (this._socket) {\n    this._socket.removeAllListeners();\n    // catch all socket error after removing all standard handlers\n    var socket = this._socket;\n    this._socket.on('error', function () {\n      try {\n        socket.destroy();\n      } catch (e) {}\n    });\n    try {\n      if (!error) this._socket.end();else this._socket.destroy();\n    } catch (e) {/* Ignore termination errors */}\n    this._socket = null;\n  }\n  if (this._sender) {\n    this._sender.removeAllListeners();\n    this._sender = null;\n  }\n  if (this._receiver) {\n    this._receiver.cleanup();\n    this._receiver = null;\n  }\n  this.removeAllListeners();\n  this.on('error', function () {}); // catch all errors after this\n  delete this._queue;\n}","map":{"version":3,"names":["util","require","events","http","https","crypto","url","stream","Options","Sender","Receiver","SenderHixie","ReceiverHixie","protocolVersion","closeTimeout","WebSocket","address","protocols","options","Array","isArray","_socket","bytesReceived","readyState","supports","initAsServerClient","apply","concat","initAsClient","inherits","EventEmitter","forEach","state","index","prototype","close","code","data","CLOSING","CLOSED","CONNECTING","_closeCode","_closeMessage","mask","_isServer","_sender","e","emit","terminate","pause","OPEN","Error","ping","dontFailWhenClosed","pong","resume","send","cb","_queue","self","push","fin","binary","ArrayBuffer","Buffer","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array","Float32Array","Float64Array","readable","Readable","Stream","startQueue","sendStream","error","process","nextTick","executeQueueSends","final","bind","end","cleanupWebsocketResources","call","_closeTimer","setTimeout","Object","defineProperty","get","amount","bufferSize","method","listener","listeners","_listener","undefined","set","removeAllListeners","addEventListener","target","onMessage","flags","MessageEvent","on","onClose","message","CloseEvent","onError","event","onOpen","OpenEvent","module","exports","dataArg","typeArg","type","reason","wasClean","req","socket","upgradeHead","protocol","merge","value","upgradeReq","establishConnection","origin","host","headers","agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","serverUrl","parse","isUnixSocket","isSecure","httpObj","port","auth","Date","now","toString","shasum","createHash","update","expectedServerKey","digest","headerHost","hostname","requestOptions","header","hasOwnProperty","isDefinedAndNonNull","Agent","path","socketPath","pathname","request","once","res","statusCode","abort","serverKey","serverProt","protList","split","protError","indexOf","ReceiverClass","SenderClass","setNoDelay","_receiver","firstHandler","length","head","add","dataHandler","realHandler","ontext","onbinary","onping","onpong","onclose","onerror","errorCode","instance","queue","i","l","emitClose","clearTimeout","destroy","cleanup"],"sources":["D:/Deneme/my-app/node_modules/express-ws/node_modules/ws/lib/WebSocket.js"],"sourcesContent":["/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\n\nvar util = require('util')\n  , events = require('events')\n  , http = require('http')\n  , https = require('https')\n  , crypto = require('crypto')\n  , url = require('url')\n  , stream = require('stream')\n  , Options = require('options')\n  , Sender = require('./Sender')\n  , Receiver = require('./Receiver')\n  , SenderHixie = require('./Sender.hixie')\n  , ReceiverHixie = require('./Receiver.hixie');\n\n/**\n * Constants\n */\n\n// Default protocol version\n\nvar protocolVersion = 13;\n\n// Close timeout\n\nvar closeTimeout = 30000; // Allow 5 seconds to terminate the connection cleanly\n\n/**\n * WebSocket implementation\n */\n\nfunction WebSocket(address, protocols, options) {\n\n  if (protocols && !Array.isArray(protocols) && 'object' == typeof protocols) {\n    // accept the \"options\" Object as the 2nd argument\n    options = protocols;\n    protocols = null;\n  }\n  if ('string' == typeof protocols) {\n    protocols = [ protocols ];\n  }\n  if (!Array.isArray(protocols)) {\n    protocols = [];\n  }\n  // TODO: actually handle the `Sub-Protocols` part of the WebSocket client\n\n  this._socket = null;\n  this.bytesReceived = 0;\n  this.readyState = null;\n  this.supports = {};\n\n  if (Array.isArray(address)) {\n    initAsServerClient.apply(this, address.concat(options));\n  } else {\n    initAsClient.apply(this, [address, protocols, options]);\n  }\n}\n\n/**\n * Inherits from EventEmitter.\n */\n\nutil.inherits(WebSocket, events.EventEmitter);\n\n/**\n * Ready States\n */\n\n[\"CONNECTING\", \"OPEN\", \"CLOSING\", \"CLOSED\"].forEach(function (state, index) {\n    WebSocket.prototype[state] = WebSocket[state] = index;\n});\n\n/**\n * Gracefully closes the connection, after sending a description message to the server\n *\n * @param {Object} data to be sent to the server\n * @api public\n */\n\nWebSocket.prototype.close = function(code, data) {\n  if (this.readyState == WebSocket.CLOSING || this.readyState == WebSocket.CLOSED) return;\n  if (this.readyState == WebSocket.CONNECTING) {\n    this.readyState = WebSocket.CLOSED;\n    return;\n  }\n  try {\n    this.readyState = WebSocket.CLOSING;\n    this._closeCode = code;\n    this._closeMessage = data;\n    var mask = !this._isServer;\n    this._sender.close(code, data, mask);\n  }\n  catch (e) {\n    this.emit('error', e);\n  }\n  finally {\n    this.terminate();\n  }\n}\n\n/**\n * Pause the client stream\n *\n * @api public\n */\n\nWebSocket.prototype.pause = function() {\n  if (this.readyState != WebSocket.OPEN) throw new Error('not opened');\n  return this._socket.pause();\n}\n\n/**\n * Sends a ping\n *\n * @param {Object} data to be sent to the server\n * @param {Object} Members - mask: boolean, binary: boolean\n * @param {boolean} dontFailWhenClosed indicates whether or not to throw if the connection isnt open\n * @api public\n */\n\nWebSocket.prototype.ping = function(data, options, dontFailWhenClosed) {\n  if (this.readyState != WebSocket.OPEN) {\n    if (dontFailWhenClosed === true) return;\n    throw new Error('not opened');\n  }\n  options = options || {};\n  if (typeof options.mask == 'undefined') options.mask = !this._isServer;\n  this._sender.ping(data, options);\n}\n\n/**\n * Sends a pong\n *\n * @param {Object} data to be sent to the server\n * @param {Object} Members - mask: boolean, binary: boolean\n * @param {boolean} dontFailWhenClosed indicates whether or not to throw if the connection isnt open\n * @api public\n */\n\nWebSocket.prototype.pong = function(data, options, dontFailWhenClosed) {\n  if (this.readyState != WebSocket.OPEN) {\n    if (dontFailWhenClosed === true) return;\n    throw new Error('not opened');\n  }\n  options = options || {};\n  if (typeof options.mask == 'undefined') options.mask = !this._isServer;\n  this._sender.pong(data, options);\n}\n\n/**\n * Resume the client stream\n *\n * @api public\n */\n\nWebSocket.prototype.resume = function() {\n  if (this.readyState != WebSocket.OPEN) throw new Error('not opened');\n  return this._socket.resume();\n}\n\n/**\n * Sends a piece of data\n *\n * @param {Object} data to be sent to the server\n * @param {Object} Members - mask: boolean, binary: boolean\n * @param {function} Optional callback which is executed after the send completes\n * @api public\n */\n\nWebSocket.prototype.send = function(data, options, cb) {\n  if (typeof options == 'function') {\n    cb = options;\n    options = {};\n  }\n  if (this.readyState != WebSocket.OPEN) {\n    if (typeof cb == 'function') cb(new Error('not opened'));\n    else throw new Error('not opened');\n    return;\n  }\n  if (!data) data = '';\n  if (this._queue) {\n    var self = this;\n    this._queue.push(function() { self.send(data, options, cb); });\n    return;\n  }\n  options = options || {};\n  options.fin = true;\n  if (typeof options.binary == 'undefined') {\n    options.binary = (data instanceof ArrayBuffer || data instanceof Buffer ||\n      data instanceof Uint8Array ||\n      data instanceof Uint16Array ||\n      data instanceof Uint32Array ||\n      data instanceof Int8Array ||\n      data instanceof Int16Array ||\n      data instanceof Int32Array ||\n      data instanceof Float32Array ||\n      data instanceof Float64Array);\n  }\n  if (typeof options.mask == 'undefined') options.mask = !this._isServer;\n  var readable = typeof stream.Readable == 'function' ? stream.Readable : stream.Stream;\n  if (data instanceof readable) {\n    startQueue(this);\n    var self = this;\n    sendStream(this, data, options, function(error) {\n      process.nextTick(function() { executeQueueSends(self); });\n      if (typeof cb == 'function') cb(error);\n    });\n  }\n  else this._sender.send(data, options, cb);\n}\n\n/**\n * Streams data through calls to a user supplied function\n *\n * @param {Object} Members - mask: boolean, binary: boolean\n * @param {function} 'function (error, send)' which is executed on successive ticks of which send is 'function (data, final)'.\n * @api public\n */\n\nWebSocket.prototype.stream = function(options, cb) {\n  if (typeof options == 'function') {\n    cb = options;\n    options = {};\n  }\n  var self = this;\n  if (typeof cb != 'function') throw new Error('callback must be provided');\n  if (this.readyState != WebSocket.OPEN) {\n    if (typeof cb == 'function') cb(new Error('not opened'));\n    else throw new Error('not opened');\n    return;\n  }\n  if (this._queue) {\n    this._queue.push(function() { self.stream(options, cb); });\n    return;\n  }\n  options = options || {};\n  if (typeof options.mask == 'undefined') options.mask = !this._isServer;\n  startQueue(this);\n  var send = function(data, final) {\n    try {\n      if (self.readyState != WebSocket.OPEN) throw new Error('not opened');\n      options.fin = final === true;\n      self._sender.send(data, options);\n      if (!final) process.nextTick(cb.bind(null, null, send));\n      else executeQueueSends(self);\n    }\n    catch (e) {\n      if (typeof cb == 'function') cb(e);\n      else {\n        delete self._queue;\n        self.emit('error', e);\n      }\n    }\n  }\n  process.nextTick(cb.bind(null, null, send));\n}\n\n/**\n * Immediately shuts down the connection\n *\n * @api public\n */\n\nWebSocket.prototype.terminate = function() {\n  if (this.readyState == WebSocket.CLOSED) return;\n  if (this._socket) {\n    try {\n      // End the connection\n      this._socket.end();\n    }\n    catch (e) {\n      // Socket error during end() call, so just destroy it right now\n      cleanupWebsocketResources.call(this, true);\n      return;\n    }\n\n    // Add a timeout to ensure that the connection is completely\n    // cleaned up within 30 seconds, even if the clean close procedure\n    // fails for whatever reason\n    this._closeTimer = setTimeout(cleanupWebsocketResources.bind(this, true), closeTimeout);\n  }\n  else if (this.readyState == WebSocket.CONNECTING) {\n    cleanupWebsocketResources.call(this, true);\n  }\n};\n\n/**\n * Expose bufferedAmount\n *\n * @api public\n */\n\nObject.defineProperty(WebSocket.prototype, 'bufferedAmount', {\n  get: function get() {\n    var amount = 0;\n    if (this._socket) {\n      amount = this._socket.bufferSize || 0;\n    }\n    return amount;\n  }\n});\n\n/**\n * Emulates the W3C Browser based WebSocket interface using function members.\n *\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\n\n['open', 'error', 'close', 'message'].forEach(function(method) {\n  Object.defineProperty(WebSocket.prototype, 'on' + method, {\n    /**\n     * Returns the current listener\n     *\n     * @returns {Mixed} the set function or undefined\n     * @api public\n     */\n\n    get: function get() {\n      var listener = this.listeners(method)[0];\n      return listener ? (listener._listener ? listener._listener : listener) : undefined;\n    },\n\n    /**\n     * Start listening for events\n     *\n     * @param {Function} listener the listener\n     * @returns {Mixed} the set function or undefined\n     * @api public\n     */\n\n    set: function set(listener) {\n      this.removeAllListeners(method);\n      this.addEventListener(method, listener);\n    }\n  });\n});\n\n/**\n * Emulates the W3C Browser based WebSocket interface using addEventListener.\n *\n * @see https://developer.mozilla.org/en/DOM/element.addEventListener\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\nWebSocket.prototype.addEventListener = function(method, listener) {\n  var target = this;\n  if (typeof listener === 'function') {\n    if (method === 'message') {\n      function onMessage (data, flags) {\n        listener.call(this, new MessageEvent(data, flags.binary ? 'Binary' : 'Text', target));\n      }\n      // store a reference so we can return the original function from the addEventListener hook\n      onMessage._listener = listener;\n      this.on(method, onMessage);\n    } else if (method === 'close') {\n      function onClose (code, message) {\n        listener.call(this, new CloseEvent(code, message, target));\n      }\n      // store a reference so we can return the original function from the addEventListener hook\n      onClose._listener = listener;\n      this.on(method, onClose);\n    } else if (method === 'error') {\n      function onError (event) {\n        event.target = target;\n        listener.call(this, event);\n      }\n      // store a reference so we can return the original function from the addEventListener hook\n      onError._listener = listener;\n      this.on(method, onError);\n    } else if (method === 'open') {\n      function onOpen () {\n        listener.call(this, new OpenEvent(target));\n      }\n      // store a reference so we can return the original function from the addEventListener hook\n      onOpen._listener = listener;\n      this.on(method, onOpen);\n    } else {\n      this.on(method, listener);\n    }\n  }\n}\n\nmodule.exports = WebSocket;\n\n/**\n * W3C MessageEvent\n *\n * @see http://www.w3.org/TR/html5/comms.html\n * @api private\n */\n\nfunction MessageEvent(dataArg, typeArg, target) {\n  this.data = dataArg;\n  this.type = typeArg;\n  this.target = target;\n}\n\n/**\n * W3C CloseEvent\n *\n * @see http://www.w3.org/TR/html5/comms.html\n * @api private\n */\n\nfunction CloseEvent(code, reason, target) {\n  this.wasClean = (typeof code == 'undefined' || code == 1000);\n  this.code = code;\n  this.reason = reason;\n  this.target = target;\n}\n\n/**\n * W3C OpenEvent\n *\n * @see http://www.w3.org/TR/html5/comms.html\n * @api private\n */\n\nfunction OpenEvent(target) {\n  this.target = target;\n}\n\n/**\n * Entirely private apis,\n * which may or may not be bound to a sepcific WebSocket instance.\n */\n\nfunction initAsServerClient(req, socket, upgradeHead, options) {\n  options = new Options({\n    protocolVersion: protocolVersion,\n    protocol: null\n  }).merge(options);\n\n  // expose state properties\n  this.protocol = options.value.protocol;\n  this.protocolVersion = options.value.protocolVersion;\n  this.supports.binary = (this.protocolVersion != 'hixie-76');\n  this.upgradeReq = req;\n  this.readyState = WebSocket.CONNECTING;\n  this._isServer = true;\n\n  // establish connection\n  if (options.value.protocolVersion == 'hixie-76') establishConnection.call(this, ReceiverHixie, SenderHixie, socket, upgradeHead);\n  else establishConnection.call(this, Receiver, Sender, socket, upgradeHead);\n}\n\nfunction initAsClient(address, protocols, options) {\n  options = new Options({\n    origin: null,\n    protocolVersion: protocolVersion,\n    host: null,\n    headers: null,\n    protocol: null,\n    agent: null,\n\n    // ssl-related options\n    pfx: null,\n    key: null,\n    passphrase: null,\n    cert: null,\n    ca: null,\n    ciphers: null,\n    rejectUnauthorized: null\n  }).merge(options);\n  if (options.value.protocolVersion != 8 && options.value.protocolVersion != 13) {\n    throw new Error('unsupported protocol version');\n  }\n\n  // verify url and establish http class\n  var serverUrl = url.parse(address);\n  var isUnixSocket = serverUrl.protocol === 'ws+unix:';\n  if (!serverUrl.host && !isUnixSocket) throw new Error('invalid url');\n  var isSecure = serverUrl.protocol === 'wss:' || serverUrl.protocol === 'https:';\n  var httpObj = isSecure ? https : http;\n  var port = serverUrl.port || (isSecure ? 443 : 80);\n  var auth = serverUrl.auth;\n\n  // expose state properties\n  this._isServer = false;\n  this.url = address;\n  this.protocolVersion = options.value.protocolVersion;\n  this.supports.binary = (this.protocolVersion != 'hixie-76');\n\n  // begin handshake\n  var key = new Buffer(options.value.protocolVersion + '-' + Date.now()).toString('base64');\n  var shasum = crypto.createHash('sha1');\n  shasum.update(key + '258EAFA5-E914-47DA-95CA-C5AB0DC85B11');\n  var expectedServerKey = shasum.digest('base64');\n\n  var agent = options.value.agent;\n\n  var headerHost = serverUrl.hostname;\n  // Append port number to Host and Origin header, only if specified in the url and non-default\n  if(serverUrl.port) {\n    if((isSecure && (port != 443)) || (!isSecure && (port != 80))){\n      headerHost = headerHost + ':' + port;\n    }\n  }\n\n  var requestOptions = {\n    port: port,\n    host: serverUrl.hostname,\n    headers: {\n      'Connection': 'Upgrade',\n      'Upgrade': 'websocket',\n      'Host': headerHost,\n      'Origin': headerHost,\n      'Sec-WebSocket-Version': options.value.protocolVersion,\n      'Sec-WebSocket-Key': key\n    }\n  };\n\n  // If we have basic auth.\n  if (auth) {\n    requestOptions.headers['Authorization'] = 'Basic ' + new Buffer(auth).toString('base64');\n  }\n\n  if (options.value.protocol) {\n    requestOptions.headers['Sec-WebSocket-Protocol'] = options.value.protocol;\n  }\n\n  if (options.value.host) {\n    requestOptions.headers['Host'] = options.value.host;\n  }\n\n  if (options.value.headers) {\n    for (var header in options.value.headers) {\n       if (options.value.headers.hasOwnProperty(header)) {\n        requestOptions.headers[header] = options.value.headers[header];\n       }\n    }\n  }\n\n  if (options.isDefinedAndNonNull('pfx')\n   || options.isDefinedAndNonNull('key')\n   || options.isDefinedAndNonNull('passphrase')\n   || options.isDefinedAndNonNull('cert')\n   || options.isDefinedAndNonNull('ca')\n   || options.isDefinedAndNonNull('ciphers')\n   || options.isDefinedAndNonNull('rejectUnauthorized')) {\n\n    if (options.isDefinedAndNonNull('pfx')) requestOptions.pfx = options.value.pfx;\n    if (options.isDefinedAndNonNull('key')) requestOptions.key = options.value.key;\n    if (options.isDefinedAndNonNull('passphrase')) requestOptions.passphrase = options.value.passphrase;\n    if (options.isDefinedAndNonNull('cert')) requestOptions.cert = options.value.cert;\n    if (options.isDefinedAndNonNull('ca')) requestOptions.ca = options.value.ca;\n    if (options.isDefinedAndNonNull('ciphers')) requestOptions.ciphers = options.value.ciphers;\n    if (options.isDefinedAndNonNull('rejectUnauthorized')) requestOptions.rejectUnauthorized = options.value.rejectUnauthorized;\n\n    if (!agent) {\n        // global agent ignores client side certificates\n        agent = new httpObj.Agent(requestOptions);\n    }\n  }\n\n  requestOptions.path = serverUrl.path || '/';\n\n  if (agent) {\n    requestOptions.agent = agent;\n  }\n\n  if (isUnixSocket) {\n    requestOptions.socketPath = serverUrl.pathname;\n  }\n  if (options.value.origin) {\n    if (options.value.protocolVersion < 13) requestOptions.headers['Sec-WebSocket-Origin'] = options.value.origin;\n    else requestOptions.headers['Origin'] = options.value.origin;\n  }\n\n  var self = this;\n  var req = httpObj.request(requestOptions);\n\n  req.on('error', function(error) {\n    self.emit('error', error);\n    cleanupWebsocketResources.call(this, error);\n  });\n\n  req.once('response', function(res) {\n    if (!self.emit('unexpected-response', req, res)) {\n      var error = new Error('unexpected server response (' + res.statusCode + ')');\n      req.abort();\n      self.emit('error', error);\n    }\n    cleanupWebsocketResources.call(this, error);\n  });\n\n  req.once('upgrade', function(res, socket, upgradeHead) {\n    if (self.readyState == WebSocket.CLOSED) {\n      // client closed before server accepted connection\n      self.emit('close');\n      self.removeAllListeners();\n      socket.end();\n      return;\n    }\n    var serverKey = res.headers['sec-websocket-accept'];\n    if (typeof serverKey == 'undefined' || serverKey !== expectedServerKey) {\n      self.emit('error', 'invalid server key');\n      self.removeAllListeners();\n      socket.end();\n      return;\n    }\n\n    var serverProt = res.headers['sec-websocket-protocol'];\n    var protList = (options.value.protocol || \"\").split(/, */);\n    var protError = null;\n    if (!options.value.protocol && serverProt) {\n        protError = 'server sent a subprotocol even though none requested';\n    } else if (options.value.protocol && !serverProt) {\n        protError = 'server sent no subprotocol even though requested';\n    } else if (serverProt && protList.indexOf(serverProt) === -1) {\n        protError = 'server responded with an invalid protocol';\n    }\n    if (protError) {\n        self.emit('error', protError);\n        self.removeAllListeners();\n        socket.end();\n        return;\n    } else if (serverProt) {\n        self.protocol = serverProt;\n    }\n\n    establishConnection.call(self, Receiver, Sender, socket, upgradeHead);\n\n    // perform cleanup on http resources\n    req.removeAllListeners();\n    req = null;\n    agent = null;\n  });\n\n  req.end();\n  this.readyState = WebSocket.CONNECTING;\n}\n\nfunction establishConnection(ReceiverClass, SenderClass, socket, upgradeHead) {\n  this._socket = socket;\n  socket.setTimeout(0);\n  socket.setNoDelay(true);\n  var self = this;\n  this._receiver = new ReceiverClass();\n\n  // socket cleanup handlers\n  socket.on('end', cleanupWebsocketResources.bind(this));\n  socket.on('close', cleanupWebsocketResources.bind(this));\n  socket.on('error', cleanupWebsocketResources.bind(this));\n\n  // ensure that the upgradeHead is added to the receiver\n  function firstHandler(data) {\n    if (self.readyState != WebSocket.OPEN) return;\n    if (upgradeHead && upgradeHead.length > 0) {\n      self.bytesReceived += upgradeHead.length;\n      var head = upgradeHead;\n      upgradeHead = null;\n      self._receiver.add(head);\n    }\n    dataHandler = realHandler;\n    if (data) {\n      self.bytesReceived += data.length;\n      self._receiver.add(data);\n    }\n  }\n  // subsequent packets are pushed straight to the receiver\n  function realHandler(data) {\n    if (data) self.bytesReceived += data.length;\n    self._receiver.add(data);\n  }\n  var dataHandler = firstHandler;\n  // if data was passed along with the http upgrade,\n  // this will schedule a push of that on to the receiver.\n  // this has to be done on next tick, since the caller\n  // hasn't had a chance to set event handlers on this client\n  // object yet.\n  process.nextTick(firstHandler);\n\n  // receiver event handlers\n  self._receiver.ontext = function (data, flags) {\n    flags = flags || {};\n    self.emit('message', data, flags);\n  };\n  self._receiver.onbinary = function (data, flags) {\n    flags = flags || {};\n    flags.binary = true;\n    self.emit('message', data, flags);\n  };\n  self._receiver.onping = function(data, flags) {\n    flags = flags || {};\n    self.pong(data, {mask: !self._isServer, binary: flags.binary === true}, true);\n    self.emit('ping', data, flags);\n  };\n  self._receiver.onpong = function(data, flags) {\n    self.emit('pong', data, flags);\n  };\n  self._receiver.onclose = function(code, data, flags) {\n    flags = flags || {};\n    self.close(code, data);\n  };\n  self._receiver.onerror = function(reason, errorCode) {\n    // close the connection when the receiver reports a HyBi error code\n    self.close(typeof errorCode != 'undefined' ? errorCode : 1002, '');\n    self.emit('error', reason, errorCode);\n  };\n\n  // finalize the client\n  this._sender = new SenderClass(socket);\n  this._sender.on('error', function(error) {\n    self.close(1002, '');\n    self.emit('error', error);\n  });\n  this.readyState = WebSocket.OPEN;\n  this.emit('open');\n\n  socket.on('data', dataHandler);\n}\n\nfunction startQueue(instance) {\n  instance._queue = instance._queue || [];\n}\n\nfunction executeQueueSends(instance) {\n  var queue = instance._queue;\n  if (typeof queue == 'undefined') return;\n  delete instance._queue;\n  for (var i = 0, l = queue.length; i < l; ++i) {\n    queue[i]();\n  }\n}\n\nfunction sendStream(instance, stream, options, cb) {\n  stream.on('data', function(data) {\n    if (instance.readyState != WebSocket.OPEN) {\n      if (typeof cb == 'function') cb(new Error('not opened'));\n      else {\n        delete instance._queue;\n        instance.emit('error', new Error('not opened'));\n      }\n      return;\n    }\n    options.fin = false;\n    instance._sender.send(data, options);\n  });\n  stream.on('end', function() {\n    if (instance.readyState != WebSocket.OPEN) {\n      if (typeof cb == 'function') cb(new Error('not opened'));\n      else {\n        delete instance._queue;\n        instance.emit('error', new Error('not opened'));\n      }\n      return;\n    }\n    options.fin = true;\n    instance._sender.send(null, options);\n    if (typeof cb == 'function') cb(null);\n  });\n}\n\nfunction cleanupWebsocketResources(error) {\n  if (this.readyState == WebSocket.CLOSED) return;\n  var emitClose = this.readyState != WebSocket.CONNECTING;\n  this.readyState = WebSocket.CLOSED;\n\n  clearTimeout(this._closeTimer);\n  this._closeTimer = null;\n  if (emitClose) this.emit('close', this._closeCode || 1000, this._closeMessage || '');\n\n  if (this._socket) {\n    this._socket.removeAllListeners();\n    // catch all socket error after removing all standard handlers\n    var socket = this._socket;\n    this._socket.on('error', function() {\n      try { socket.destroy(); } catch (e) {}\n    });\n    try {\n      if (!error) this._socket.end();\n      else this._socket.destroy();\n    }\n    catch (e) { /* Ignore termination errors */ }\n    this._socket = null;\n  }\n  if (this._sender) {\n    this._sender.removeAllListeners();\n    this._sender = null;\n  }\n  if (this._receiver) {\n    this._receiver.cleanup();\n    this._receiver = null;\n  }\n  this.removeAllListeners();\n  this.on('error', function() {}); // catch all errors after this\n  delete this._queue;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}